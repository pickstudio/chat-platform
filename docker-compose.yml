version: "3.9"

# 실행 docker-compose up --build
# 실행 + daemonize docker-compose up --build -d
# 도커 종료하기 docker-compose [down / stop]

services:
  chat-web:
    container_name: chat-web
    build:
      context: nginx/
      dockerfile: .
    ports:
      - "80:80"
      - "8080:8080"
    depends_on:
      - chat-api

  chat-api:
    container_name: chat-api
    build:
      context: .
      dockerfile: server/api/.
    command: gunicorn -k uvicorn.workers.UvicornWorker server.api.main:app --bind 0.0.0.0:9000 --reload
    volumes:
      - .:/code
    expose:
      - "9000"

  chat-message:
    container_name: chat-message
    build:
      context: .
      dockerfile: server/message/.
    command: gunicorn -k uvicorn.workers.UvicornWorker server.message.main:app --bind 0.0.0.0:9001 --reload
    volumes:
      - .:/code
    expose:
      - "9001"
